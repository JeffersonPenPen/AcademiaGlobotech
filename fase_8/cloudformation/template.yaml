AWSTemplateFormatVersion: '2010-09-09'\nDescription: CloudFormation template for Holo Tasker Hub application deployment.\nParameters:  \n  KeyPairName:  \n    Type: String  \n    Description: Name of an existing EC2 KeyPair to enable SSH access to the instance.\n  DBPassword:  \n    Type: String  \n    Description: The password for the RDS database.  \n    NoEcho: true  \n  SupabaseProjectId:  \n    Type: String  \n    Description: Supabase project ID.\n  SupabasePublishableKey:  \n    Type: String  \n    Description: Supabase publishable key.\n  SupabaseUrl:  \n    Type: String  \n    Description: Supabase URL.\n  GeminiApiKey:  \n    Type: String  \n    Description: Gemini API key.\n  JWTSecret:  \n    Type: String  \n    Description: JWT secret for application.\nResources:  \n  VPC:  \n    Type: AWS::EC2::VPC  \n    Properties:  \n      CidrBlock: '10.0.0.0/16'  \n      EnableDnsSupport: true  \n      EnableDnsHostname: true  \n      Tags:  \n        - Key: Name  \n          Value: HoloTaskerVPC  \n  Subnet1:  \n    Type: AWS::EC2::Subnet  \n    Properties:  \n      VpcId: !Ref VPC  \n      CidrBlock: '10.0.1.0/24'  \n      AvailabilityZone: !Select [0, !GetAZs '']  \n      Tags:  \n        - Key: Name  \n          Value: HoloTaskerSubnet1  \n  Subnet2:  \n    Type: AWS::EC2::Subnet  \n    Properties:  \n      VpcId: !Ref VPC  \n      CidrBlock: '10.0.2.0/24'  \n      AvailabilityZone: !Select [1, !GetAZs '']  \n      Tags:  \n        - Key: Name  \n          Value: HoloTaskerSubnet2  \n  InternetGateway:  \n    Type: AWS::EC2::InternetGateway  \n    Properties:  \n      Tags:  \n        - Key: Name  \n          Value: HoloTaskerIGW  \n  AttachGateway:  \n    Type: AWS::EC2::VPCGatewayAttachment  \n    Properties:  \n      VpcId: !Ref VPC  \n      InternetGatewayId: !Ref InternetGateway  \n  EC2SecurityGroup:  \n    Type: AWS::EC2::SecurityGroup  \n    Properties:  \n      GroupDescription: Allow HTTP and SSH access  \n      VpcId: !Ref VPC  \n      SecurityGroupIngress:  \n        - IpProtocol: tcp  \n          FromPort: 22  \n          ToPort: 22  \n          CidrIp: '0.0.0.0/0'  \n        - IpProtocol: tcp  \n          FromPort: 80  \n          ToPort: 80  \n          CidrIp: '0.0.0.0/0'  \n  LoadBalancer:  \n    Type: AWS::ElasticLoadBalancingV2::LoadBalancer  \n    Properties:  \n      Name: HoloTaskerALB  \n      Subnets:  \n        - !Ref Subnet1  \n        - !Ref Subnet2  \n      SecurityGroups:  \n        - !Ref EC2SecurityGroup  \n  TargetGroup:  \n    Type: AWS::ElasticLoadBalancingV2::TargetGroup  \n    Properties:  \n      Name: HoloTaskerTargetGroup  \n      Port: 80  \n      Protocol: HTTP  \n      VpcId: !Ref VPC  \n      TargetType: instance  \n  LaunchConfiguration:  \n    Type: AWS::AutoScaling::LaunchConfiguration  \n    Properties:  \n      ImageId: ami-0abcdef1234567890  \n      InstanceType: t2.micro  \n      KeyName: !Ref KeyPairName  \n      SecurityGroups:  \n        - !Ref EC2SecurityGroup  \n      UserData:  \n        Fn::Base64:  \n          !Sub |  \n            #!/bin/bash  \n            yum update -y  \n            yum install -y git  \n            git clone https://github.com/JeffersonPenPen/holo-tasker-hub-24211.git  \n            cd holo-tasker-hub-24211  \n            npm install  \n            # Set environment variables  \n            export DB_PASSWORD=${DBPassword}  \n            export SUPABASE_PROJECT_ID=${SupabaseProjectId}  \n            export SUPABASE_PUBLISHABLE_KEY=${SupabasePublishableKey}  \n            export SUPABASE_URL=${SupabaseUrl}  \n            export GEMINI_API_KEY=${GeminiApiKey}  \n            export JWT_SECRET=${JWTSecret}  \n            npm start  \n  AutoScalingGroup:  \n    Type: AWS::AutoScaling::AutoScalingGroup  \n    Properties:  \n      LaunchConfigurationName: !Ref LaunchConfiguration  \n      MinSize: 1  \n      MaxSize: 3  \n      DesiredCapacity: 2  \n      VPCZoneIdentifier:  \n        - !Ref Subnet1  \n        - !Ref Subnet2  \n      TargetGroupARNs:  \n        - !Ref TargetGroup  \n  RDSInstance:  \n    Type: AWS::RDS::DBInstance  \n    Properties:  \n      DBInstanceClass: db.t2.micro  \n      Engine: mysql  \n      MasterUsername: admin  \n      MasterUserPassword: !Ref DBPassword  \n      DBName: HoloTaskerDB  \n      VPCSecurityGroups:  \n        - !Ref EC2SecurityGroup  \n      AllocatedStorage: '20'  \n      BackupRetentionPeriod: 7  \n  EFS:  \n    Type: AWS::EFS::FileSystem  \n    Properties:  \n      CreationToken: HoloTaskerEFS  \n      PerformanceMode: generalPurpose  \n      Encrypted: true  \n      LifecyclePolicies:  \n        - TransitionToIa: AFTER_30_DAYS  \nOutputs:  \n  LoadBalancerDNS:  \n    Value: !GetAtt LoadBalancer.DNSName  \n    Description: DNS name of the load balancer.\n